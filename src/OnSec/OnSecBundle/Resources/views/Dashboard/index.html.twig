{% extends "::base.html.twig" %}

{% block title %}HSDOnSecBundle:Dashboard:index{% endblock %}

{% block content %}
    {% if(is_granted("ROLE_ADMIN")) %}
        <div id="topnav">
            <span id="topnav_text"></span>
            <label class="switch">
                <input type="checkbox" class="input_checkbox">
                <div class="slider" id='onoff' data-onoff="on" >User</div>
            </label>
        </div>
    {% endif %}
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a data-toggle="tab" class="nav-link active" href="#menu1" role="tab" id="coursetab">Meine Kurse</a>
        </li>
        <li class="nav-item" id="showtab">
            <a data-toggle="tab" class="nav-link unactive" href="#menu2" role="tab">Unterweisungen</a>
        </li>
    </ul>
    <div class="innercontainer">
        <input type="search" class="maininput" placeholder="Suche hier nach neuen oder bereits teilgenommenen Kursen oder Unterweisungen ..." id="searchinput"/>

        <div class="innerinnercontainer">
            <div class="tab-content">
                <div class="tab-pane fade in active" id="menu1">
                    <!--<div class="card-group">-->
                    {% if(is_granted("ROLE_ADMIN")) %}
                        <div id="admin_menu">
                            {% for course in moderatorcourses %}
                                <div class="card searchfield">
                                    <div class="card-header" data-target="{{ '#collapseadmin%s'|format(course.getId()) }}" data-toggle="collapse">
                                        <h4 class="card-title">
                                            {{ course.getDescription() }}{% for keyword in course.getKeywords() %}<p hidden>{{ keyword.getDescription() }}</p>{% endfor %}
                                            <span data-toggle="modal" data-target="#MyModal_{{ course.getId() }}">
                                                <i class="fa fa-users" aria-hidden="true"></i>
                                            </span>
                                            <span onclick="document.location.href = '{{ path('course_edit', { 'id': course.getId() }) }}'; return false"><i class="fa fa-cog"
                                                                                                          aria-hidden="true"></i></span>
                                        </h4>
                                    </div>
                                    <div class="card-collapse collapse" id="{{ 'collapseadmin%s'|format(course.getId()) }}">
                                        <ul class="list-group">
                                            {% for instruction in course.getInstructions() %}
                                                <li class="list-group-item">{{ instruction.getDescription() }}{% for keyword in instruction.getKeywords() %}<p hidden>{{ keyword.getDescription() }}</p>{% endfor %}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>


                                <div id="MyModal_{{ course.getId() }}" class="modal fade" role="dialog">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <div class="modal-title">Teilnehmer von {{ course.getDescription() }}
                                                    <div class="pull-right">
                                                        <select class="custom-select" name="semester">
                                                            {% for semester in ['SS 2016', 'WS 2016/17', 'SS 2017'] %}
                                                                <option value="{{ semester }}">{{ semester }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="modal-body">
                                                {{ render(controller('HSDOnSecBundle:Dashboard:modal', {'course': course})) }}
                                            </div>
                                            <div class="modal-footer"><a class="btn btn-primary" href="{{ path('createCSV', {'course_id': course.getId() }) }}" role="button">CSV exportieren</a></div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <div id="user_menu">
                        {% for coursesub in subscribercourses %}
                            <div class="card">
                                <div class="card-header" data-target="{{ '#collapseuser%s'|format(coursesub.getId()) }}" data-toggle="collapse">
                                    <h4 class="card-title">
                                        {{ coursesub.getDescription() }}
                                    </h4>
                                </div>
                                <div class="card-collapse collapse" id="{{ 'collapseuser%s'|format(coursesub.getId()) }}">
                                    <ul class="list-group">
                                        {% for instructionsub in coursesub.getInstructions() %}
                                            {% for completedinstruction in  user.getCompletedInstructions() %}
                                                {% if instructionsub.getId() ==  completedinstruction.getId() %}
                                                    <li class="list-group-item">{{ instructionsub.getDescription() }}<div class="checkbuttonopen"><i style="color: white" class="fa fa-check" aria-hidden="true"></i></div><div style="float: right; margin-right: 30px;">21.05.2017</div></li>
                                                {% else %}
                                                    <li class="list-group-item">{{ instructionsub.getDescription() }}<div class="checkbuttonclose"><i style="color: white" class="fa fa-times" aria-hidden="true"></i></div><a href="{{ path('instruction_run', { 'id': instructionsub.getId() }) }}" class="btn btn-success" style="float: right; margin-right: 30px; margin-top: -7px">Start</a></li>
                                                {% endif %}
                                            {% endfor %}
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <!--</div>-->
                </div>
                {% if(is_granted("ROLE_ADMIN")) %}
                    <div class="tab-pane fade" id="menu2">
                        {% for instruction in ownerinstructions %}
                        <div class="card searchfield">
                            <div class="card-header">
                                <h4 class="card-title">
                                    {{ instruction.getDescription() }}<span onclick="document.location.href = '{{ path('instruction_edit', { 'id': instruction.getId() }) }}'; return false"><i class="fa fa-cog" aria-hidden="true"></i></span>
                                    <div class="right red">Eigent&uuml;mer</div>{% for keyword in instruction.getKeywords() %}<p hidden>{{ keyword.getDescription() }}</p>{% endfor %}
                                </h4>
                            </div>
                        </div>
                        {% endfor %}
                        {% if moderatorinstructions|length > 0 %}<hr>{% endif %}
                        {% for instruction in moderatorinstructions %}
                            <div class="card searchfield">
                                <div class="card-header">
                                    <h4 class="card-title">
                                        {{ instruction.getDescription() }}<span onclick="document.location.href = '{{ path('instruction_edit', { 'id': instruction.getId() }) }}'; return false"><i class="fa fa-cog" aria-hidden="true"></i></span>
                                        <div class="right green">Bearbeiter</div>{% for keyword in instruction.getKeywords() %}<p hidden>{{ keyword.getDescription() }}</p>{% endfor %}
                                    </h4>
                                </div>
                            </div>
                        {% endfor %}
                        <!--{#% if userinstructions|length > 0 %#}<hr>{#% endif %#}
                        {#% for instruction in userinstructions %#}
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">
                                        {#{ instruction.getDescription() }#}<span onclick="document.location.href = '{#{ path('instruction_edit', { 'id': instruction.getId() }) }#}'; return false"><i class="fa fa-cog" aria-hidden="true"></i></span>
                                        <div class="right blue">Nutzer</div>
                                    </h4>
                                </div>
                            </div>
                        {#% endfor %#}
                        -->
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function(){
            $("#topnav_text").html("<a href={{ path('course_new') }}>Neuen Kurs erstellen</a>");
            $("#showtab").hide();
            $("#coursetab").html("Meine absolvierten Unterweisungen");
            $("#topnav_text").hide();
            $("#user_menu").show();
            $("#admin_menu").hide();
            $('a[data-toggle="tab"]').on('show.bs.tab', function(e) {
                localStorage.setItem('activeTab', $(e.target).attr('href'));

                var activeTab = localStorage.getItem('activeTab');

                if(activeTab=="#menu1"){
                    $("#topnav_text").html("<a href={{ path('course_new') }}>Neue Kurs erstellen</a>");
                    $("#searchinput").attr("placeholder", "Suche hier nach deinen Kursen ...");
                }
                else if(activeTab=="#menu2"){
                    $("#topnav_text").html("<a href={{ path('instruction_new') }}>Neue Unterweisung erstellen</a>");
                    $("#searchinput").attr("placeholder", "Suche hier nach deinen Unterweisungen ...");
                }
            });
            $('#onoff').click(function () {
                var show = $('#onoff').attr("data-onoff");
                if(show=='on'){
                    $("#onoff").html("Admin");
                    $('#onoff').attr("data-onoff","off");
                    $("#showtab").show();
                    $("#coursetab").html("Meine Kurse");
                    $("#searchinput").attr("placeholder", "Suche hier nach deinen Kursen ...");
                    $("#topnav_text").show();
                    $("#user_menu").hide();
                    $("#admin_menu").show();
                }
                else {
                    $("#onoff").html("User");
                    $('#onoff').attr("data-onoff","on");
                    $('#coursetab')[0].click();
                    $("#showtab").hide();
                    $("#coursetab").html("Meine absolvierten Unterweisungen");
                    $("#searchinput").attr("placeholder", "Suche hier nach neuen oder bereits teilgenommenen Kursen oder Unterweisungen ...");
                    $("#topnav_text").hide();
                    $("#user_menu").show();
                    $("#admin_menu").hide();
                }
            });
            $('.searchfield').show();
            $('#searchinput').keyup(function(){
                $('.searchfield').hide();
                var txt = $('#searchinput').val();
                $('.searchfield').each(function(){
                    if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
                        $(this).show();
                    }
                });
            });
        });
    </script>
{% endblock %}
